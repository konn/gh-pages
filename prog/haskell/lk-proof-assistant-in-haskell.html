<!DOCTYPE html><!--[if lt IE 7]>      <html lang="ja" class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--><!--[if IE 7]>         <html lang="ja" class="no-js lt-ie9 lt-ie8"> <![endif]--><!--[if IE 8]>         <html lang="ja" class="no-js lt-ie9"> <![endif]--><!--[if gt IE 8]><!--><html lang="ja" class="no-js"><!--<![endif]--><!--[if !IE]><html lang="ja"><![endif]--><head>
  <meta charset="utf-8">
  <title>Haskell で Gentzen の LK - konn-san.com</title>
  <meta name="author" content="Hiromi ISHII">
  <meta name="Keywords" content="論理学,logic,Haskell,プログラミング,シーケント計算,Qiita移行記事"><meta name="description" content="この記事はQiitaからの移転記事です。 大昔に書いた、シーケント計算をHaskellの型システムを使って上手くエンコードした実装の記事ですが、正直何も整理されていないので、記録以上の意味はありません。
">
  <link href="/katex/katex.min.css" type="text/css" rel="stylesheet">
  <meta name="viewport" content="width=device-width">
  <link rel="canonical" href="https://konn-san.com/prog/haskell/lk-proof-assistant-in-haskell.html">
  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Atom Feed">
  <link href="/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/css/syntax.css" rel="stylesheet" media="screen">
  <link href="/css/style.css" rel="stylesheet" media="screen">
  


  <script src="//b.st-hatena.com/js/bookmark_button_wo_al.js" async="async">
  </script>
  <script src="/js/vendor/modernizr-2.6.2.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS_CHTML" async="async"></script>
  <script src="//s.hatena.ne.jp/js/HatenaStar.js"></script>
  <script>
  Hatena.Star.Token = '7bf3845df18764ea7bfa120294f8c5ed1cd371e9';
  Hatena.Star.SiteConfig = {
    entryNodes: {
      'div.container': {
        uri: 'window.location',
        title: 'document.title',
        container: 'ul#socials li#hatena-star'
      }
    }
  };
  </script>
  <!-- Twitter Card -->
  <meta property="twitter:card" content="summary">
  <meta property="twitter:site" content="@mr_konn">
  <meta property="og:url" content="https://konn-san.com/prog/haskell/lk-proof-assistant-in-haskell.html">
  <meta property="og:title" content="Haskell で Gentzen の LK">
  <meta property="og:description" content="この記事はQiitaからの移転記事です。 大昔に書いた、シーケント計算をHaskellの型システムを使って上手くエンコードした実装の記事ですが、正直何も整理されていないので、記録以上の意味はありません。 ">
  <meta property="og:image" content="https://konn-san.com/img/myface_mosaic.jpg">
  <!-- /Twitter Card -->
</head>
<body>
  <!--[if lt IE 7]>
    <p class="chromeframe">Sorry, this site doesn't support IE version &lt;7. <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
  <![endif]-->
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/ja_JP/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <a class="navbar-brand" href="/">konn-san.com</a>
  <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#Navbar" aria-controls="Navbar" aria-expanded="false" aria-label="toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="Navbar">
    <ul class="navbar-nav mr-auto">
     <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
     <li class="nav-item"><a class="nav-link" href="/profile.html">Profile</a></li>
     <li class="nav-item"><a class="nav-link" href="/math">Math</a></li>
     <li class="nav-item active"><a class="nav-link" href="/prog">Tech</a></li>
     <li class="nav-item"><a class="nav-link" href="/writing">Writings</a></li>
     <li class="nav-item"><a class="nav-link" href="/articles">Articles</a></li>
     <li class="nav-item"><a class="nav-link" href="/logs">Logs</a></li>
     <li class="nav-item"><a class="nav-link" href="/archive.html">Archive</a></li>
    </ul>
    <form class="form-inline my-2 my-lg-0" action="https://cse.google.com/" target="_blank">
      <input type="hidden" name="cx" value="008926939897329001532:wsmollxek8o">
      <input class="form-control mr-sm-2" type="text" name="q" placeholder="Search" aria-label="Search" required>
      <button class="btn btn-outline-secondary my-2 my-sm-0" type="submit">
        <i class="fa fa-search"></i>
      </button>
    </form>
  </div>
</nav>

  <div class="container">
   <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">konn-san.com 建設予定地</a></li>
    <li class="breadcrumb-item"><a href="/prog/">プログラミング関連</a></li>
  <li class="li breadcrumb-item active">Haskell で Gentzen の LK</li>
</ol>

    <div class="page-header">
    <h1>Haskell で Gentzen の LK <small>konn-san.com</small></h1>
    <div id="social">
      <i class="fa fa-bookmark" aria-hidden="true"></i>
      <ul id="socials">
      <li id="facebook">
      <div class="fb-like" data-href="https://konn-san.com/prog/haskell/lk-proof-assistant-in-haskell.html" data-send="false" data-layout="button_count" data-width="450" data-show-faces="true"></div>
      </li><li id="hatena-bookmarks">
        <a href="//b.hatena.ne.jp/entry/https://konn-san.com/prog/haskell/lk-proof-assistant-in-haskell.html" class="hatena-bookmark-button" data-hatena-bookmark-title="Haskell で Gentzen の LK - konn-san.com" data-hatena-bookmark-layout="simple-balloon" title="このエントリーをはてなブックマークに追加"><img src="//b.st-hatena.com/images/entry-button/button-only.gif" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;"></a><script src="//b.st-hatena.com/js/bookmark_button.js" async="async"></script>
      </li><li>
      <script src="//apis.google.com/js/plusone.js"></script>
      <div class="g-plusone" data-size="standard" data-count="true"></div>
      </li><li>
      <a href="//twitter.com/share" class="twitter-share-button" data-via="mr_konn" data-lang="ja">ツイート</a>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
      </li><li id="hatena-star">
      </li></ul>
    </div>
    <div><i class="fa fa-calendar" aria-hidden="true"></i> posted on 2012/05/24 00:00:00 JST</div>
    </div>
    <hr>
        <div id="page-main" data-offset="0" class="page-content text-justify" data-spy="scroll" data-target="#side-toc">
          <p><strong>この記事はQiitaからの移転記事です</strong>。</p>
<p>大学の講義で LK を習ったので、定理証明支援系を書こうと思った。
その前段階として、取り敢えず論理式に推論規則を適用する仕組みを作ることにした。（後はひっくりかえすだけ）</p>
<p>折角なので、推論規則を書いたら勝手に函数を生成してくれる準クォートを定義してそいつをつかってみた。
こんな感じに書ける。</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell:lkrules.hs"><code class="sourceCode haskell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# OPTIONS_GHC -fwarn-incomplete-patterns -fwarn-unused-imports #-}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">LKRules</span> <span class="kw">where</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.List</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">LKDataTypes</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">LKMacros</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">type</span> <span class="dt">Rule</span> <span class="ot">=</span> [<span class="dt">Sequent</span>] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">Sequent</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="ot">isInitial ::</span> <span class="dt">Sequent</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>isInitial [lkseq| a |- b |] <span class="ot">=</span> a <span class="op">==</span> b</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>[rule|</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a># Cut</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  Γ |- Δ, A   A, Σ |- Π</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>--------------------------- cut</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>       Γ, Σ |- Δ, Π</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a># Contract</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a> A, A, Γ |- Δ</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>--------------- contractL</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    A, Γ |- Δ</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a> Γ |- Δ, A, A</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>--------------- contractR</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a> Γ |- Δ, A</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a># Weakening</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    Γ ├ Δ</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>------------- weakenL</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a> A, Γ ├ Δ</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a> Γ ├ Δ</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>------------- weakenR</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a> Γ ├ Δ, A</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a># Rules for AND</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a> Γ ├ Δ, A   Σ ├ Π, B</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>-------------------------- andRight</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  Γ, Σ ├ Δ, Π, A ∧ B</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>      A, Γ ├ Δ</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>------------------ andLeftR</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>  A ∧ B, Γ ├ Δ</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>      A, Γ ├ Δ</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>------------------ andLeftL</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  B ∧ A, Γ ├ Δ</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a># Rules for OR</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a> A, Γ ├ Δ   B, Σ |- Π</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>-------------------------- orLeft</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  A ∨ B, Γ, Σ |- Δ, Π</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a> Γ ├ Δ, A</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>---------------- orRightR</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a> Γ ├ Δ, A ∨ B</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a> Γ ├ Δ, A</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>---------------- orRightL</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a> Γ ├ Δ, B ∨ A</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a># Rules for Implies</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>  A, Γ ├ Δ, B</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>-------------------------- implRight</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>     Γ ├ Δ, A → B</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>  Γ ├ Δ, A   B, Σ ├ Π</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>--------------------------- implLeft</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>  A → B , Γ, Σ ├ Δ, Π</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a># Rules for Not</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a> A, Γ ├ Δ</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>------------------ notRight</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    Γ ├ Δ, ¬ A</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>      Γ ├ Δ, A</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>------------------ notLeft</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a> ¬ A, Γ ├ Δ</span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>|]</span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>swap s1 s2 ss <span class="ot">=</span> </span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span> [start, end] <span class="ot">=</span> <span class="fu">sort</span> [s1, s2]</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        (ls, a<span class="op">:</span>rs)   <span class="ot">=</span> <span class="fu">splitAt</span> start ss</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        (ls&#39;, b<span class="op">:</span>rs&#39;) <span class="ot">=</span> <span class="fu">splitAt</span> (start<span class="op">-</span>end<span class="op">+</span><span class="dv">1</span>) rs</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">in</span> ls <span class="op">++</span> b <span class="op">:</span> ls&#39; <span class="op">++</span> a <span class="op">:</span> rs&#39;</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a><span class="ot">permutationL ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Rule</span></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>permutationL s1 s2 [ ss <span class="op">:|-</span> ds ] <span class="op">|</span> <span class="fu">max</span> s1 s2 <span class="op">&lt;</span> <span class="fu">length</span> ss <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> swap s1 s2 ss <span class="op">:|-</span> ds </span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>permutationL _ _ _ <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a><span class="ot">permutationR ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Rule</span></span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>permutationR s1 s2 [ ss <span class="op">:|-</span> ds ] <span class="op">|</span> <span class="fu">max</span> s1 s2 <span class="op">&lt;</span> <span class="fu">length</span> ds <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> ss <span class="op">:|-</span> <span class="fu">reverse</span> (swap s1 s2 <span class="op">$</span> <span class="fu">reverse</span> ds)</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>permutationR _ _ _ <span class="ot">=</span> <span class="dt">Nothing</span></span></code></pre></div>
<p>流石に可換法則はそのまま書くのはむずかしそうなのでやめた。
準クォートにしておくと、今度は逆向きのを自動生成する機能を付けたときに
Rules を一切弄らなくてすむので楽だ。
上式にない変数が下式に出て来たら、引数として外側に括り出すようにする処理とかもやっている。あと、上式に同じ文字列が出て来たらガード節をくっつけてそいつらの値が一致する、と云う条件も入れるようにしている。</p>
<p>GHCi で動かしてみるとこんな感じになる。</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> contractL [seqs| A ∧ A, A ∧ A ├ A |]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="dt">Just</span> (<span class="dt">A</span> ∧ <span class="dt">A</span> <span class="op">|-</span> <span class="dt">A</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> weakenL [lkf| A |] [seqs| C |- B |]</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="dt">Just</span> (<span class="dt">A</span>, <span class="dt">C</span> <span class="op">|-</span> <span class="dt">B</span>)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> weakenR [lkf| A |] [seqs| C |- B |]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="dt">Just</span> (<span class="dt">C</span> <span class="op">|-</span> <span class="dt">B</span>, <span class="dt">A</span>)</span></code></pre></div>
<p>例として二重否定除去を示す。</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span>  [seqs| A |- A |]</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>[<span class="dt">A</span> <span class="op">|-</span> <span class="dt">A</span>]</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> maybeToList <span class="op">$</span> notRight it</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>[ <span class="op">|-</span> <span class="dt">A</span>, ¬<span class="dt">A</span>]</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> maybeToList <span class="op">$</span> notLeft it</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>[¬¬<span class="dt">A</span> <span class="op">|-</span> <span class="dt">A</span>]</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>ghci<span class="op">&gt;</span> maybeToList <span class="op">$</span> implRight it</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>[ <span class="op">|-</span> ¬¬<span class="dt">A</span> → <span class="dt">A</span>]</span></code></pre></div>
<p>残りのソースは以下の通り。パーザ周りにまだ繰り返しているコードがあるのでそこを今度何とかする。</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell:lkmacros.hs"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE TemplateHaskell, ViewPatterns #-}</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">LKMacros</span> <span class="kw">where</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">LKDataTypes</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Language.Haskell.TH</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Language.Haskell.TH.Quote</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Char</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Generics</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Applicative</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Parsec</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.List</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Foldable</span> (foldrM)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Monad.State</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span>  <span class="dt">Data.Map</span> <span class="kw">as</span> <span class="dt">M</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="ot">lkseq ::</span> <span class="dt">QuasiQuoter</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>lkseq <span class="ot">=</span> <span class="dt">QuasiQuoter</span> { quoteType <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                    , quoteDec  <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                    , quoteExp  <span class="ot">=</span> lkSeqExp</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>                    , quotePat  <span class="ot">=</span> lkSeqPat</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>                    }</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>lkSeqExp str <span class="ot">=</span> dataToExpQ (mkQ <span class="dt">Nothing</span> anti) <span class="op">$</span> parseSequent str</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="ot">    anti ::</span> [<span class="dt">Formula</span>] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">ExpQ</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>    anti gs <span class="ot">=</span> <span class="dt">Just</span> [<span class="op">|</span> <span class="fu">concat</span> <span class="op">$</span>(listE <span class="op">$</span> <span class="fu">map</span> (appE [<span class="op">|</span> toFormulaList <span class="op">|</span>] <span class="op">.</span> dataToExpQ (mkQ <span class="dt">Nothing</span> trans)) gs) <span class="op">|</span>]</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>    trans (<span class="dt">Var</span> s) <span class="op">|</span> isFree s <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> varE (mkName s)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>    trans (<span class="dt">Var</span> (c<span class="op">:</span>cs))</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Just</span> prfx <span class="ot">&lt;-</span> <span class="fu">lookup</span> c greeks <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> varE <span class="op">$</span> mkName <span class="op">$</span> prfx<span class="op">:</span><span class="st">&quot;s&quot;</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>    trans _ <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>lkSeqPat str <span class="ot">=</span> dataToPatQ (mkQ <span class="dt">Nothing</span> anti) <span class="op">$</span> parseSequent str</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="ot">    anti ::</span> [<span class="dt">Formula</span>] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">PatQ</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    anti fs <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> <span class="fu">foldr1</span> (\a b <span class="ot">-&gt;</span> infixP a (&#39;(<span class="op">:</span>)) b) <span class="op">$</span> <span class="fu">map</span> (dataToPatQ (mkQ <span class="dt">Nothing</span> trans)) fs</span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>    trans (<span class="dt">Var</span> str) <span class="op">|</span> isFree str <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> varP <span class="op">$</span> mkName str</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>    trans (<span class="dt">Var</span> (c<span class="op">:</span>cs))</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Just</span> prfx <span class="ot">&lt;-</span> <span class="fu">lookup</span> c greeks <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> varP <span class="op">$</span> mkName <span class="op">$</span> prfx<span class="op">:</span><span class="st">&quot;s&quot;</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>    trans _ <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="ot">seqs ::</span> <span class="dt">QuasiQuoter</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>seqs <span class="ot">=</span> <span class="dt">QuasiQuoter</span> { quoteType <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>                   , quoteDec  <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>                   , quoteExp  <span class="ot">=</span> seqsExp</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>                   , quotePat  <span class="ot">=</span> seqsPat</span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a>isFree s <span class="ot">=</span> <span class="fu">not</span> (<span class="fu">null</span> s) <span class="op">&amp;&amp;</span> <span class="fu">isLower</span> (<span class="fu">head</span> s)</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a>greeks <span class="ot">=</span> <span class="fu">zip</span> <span class="st">&quot;ΓΔΣΠΘΛΞΦΩ&quot;</span> <span class="st">&quot;gdsptlxfw&quot;</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a>seqsExp str <span class="ot">=</span> dataToExpQ (mkQ <span class="dt">Nothing</span> anti) <span class="op">$</span> run (sequent <span class="ot">`sepBy`</span> spaces) str</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a><span class="ot">    anti ::</span> [<span class="dt">Formula</span>] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">ExpQ</span></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>    anti gs <span class="ot">=</span> <span class="dt">Just</span> [<span class="op">|</span> <span class="fu">concat</span> <span class="op">$</span>(listE <span class="op">$</span> <span class="fu">map</span> (appE [<span class="op">|</span> toFormulaList <span class="op">|</span>] <span class="op">.</span> dataToExpQ (mkQ <span class="dt">Nothing</span> trans)) gs) <span class="op">|</span>]</span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>    trans (<span class="dt">Var</span> s) <span class="op">|</span> isFree s <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> varE (mkName s)</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    trans (<span class="dt">Var</span> (c<span class="op">:</span>cs))</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Just</span> prfx <span class="ot">&lt;-</span> <span class="fu">lookup</span> c greeks <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> varE <span class="op">$</span> mkName <span class="op">$</span> prfx<span class="op">:</span><span class="st">&quot;s&quot;</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>    trans _ <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>seqsPat str <span class="ot">=</span> dataToPatQ (mkQ <span class="dt">Nothing</span> anti) <span class="op">$</span> run(sequent <span class="ot">`sepBy`</span> spaces) str</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="ot">    anti ::</span> [<span class="dt">Formula</span>] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">PatQ</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>    anti fs <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> <span class="fu">foldr1</span> (\a b <span class="ot">-&gt;</span> infixP a (&#39;(<span class="op">:</span>)) b) <span class="op">$</span> <span class="fu">map</span> (dataToPatQ (mkQ <span class="dt">Nothing</span> trans)) fs</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>    trans (<span class="dt">Var</span> str) <span class="op">|</span> isFree str <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> varP <span class="op">$</span> mkName str</span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>    trans (<span class="dt">Var</span> (c<span class="op">:</span>cs))</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Just</span> prfx <span class="ot">&lt;-</span> <span class="fu">lookup</span> c greeks <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> varP <span class="op">$</span> mkName <span class="op">$</span> prfx<span class="op">:</span><span class="st">&quot;s&quot;</span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>    trans _ <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="ot">lkf ::</span> <span class="dt">QuasiQuoter</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>lkf <span class="ot">=</span> <span class="dt">QuasiQuoter</span> { quoteType <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a>                      , quoteDec  <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>                      , quoteExp  <span class="ot">=</span> formulaExp</span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>                      , quotePat  <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>                      }</span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>formulaExp str <span class="ot">=</span> dataToExpQ (<span class="fu">const</span> <span class="dt">Nothing</span>) <span class="op">$</span> parseFormula str</span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a><span class="ot">rule ::</span> <span class="dt">QuasiQuoter</span></span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>rule <span class="ot">=</span> <span class="dt">QuasiQuoter</span> { quoteType <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>                   , quoteExp  <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>                   , quotePat  <span class="ot">=</span> <span class="fu">undefined</span></span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>                   , quoteDec  <span class="ot">=</span> ruleDec</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a>ruleDec str <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span> rules <span class="ot">=</span> run (many1 deducRule) str</span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">concat</span> <span class="op">&lt;$&gt;</span> <span class="fu">mapM</span> build rules</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    arrow a b <span class="ot">=</span> [t| $(a) -&gt; $(b) |]</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>    build (from, name, to) <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>      (from&#39;, dic) <span class="ot">&lt;-</span> runStateT (everywhereM (mkM renamer) from) M.empty</span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>      <span class="kw">pattern</span> <span class="ot">&lt;-</span> listP <span class="op">$</span> <span class="fu">map</span> (dataToPatQ (mkQ <span class="dt">Nothing</span> pat)) from&#39;</span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>      body    <span class="ot">&lt;-</span> dataToExpQ (mkQ <span class="dt">Nothing</span> expq) to</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>      <span class="kw">let</span> pnames <span class="ot">=</span> everything (<span class="op">++</span>) (mkQ [] extractName) from</span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>          enames <span class="ot">=</span> everything (<span class="op">++</span>) (mkQ [] extractName) to</span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>          unknown <span class="ot">=</span> enames \\ pnames</span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>          guards <span class="ot">=</span> patG <span class="op">$</span> <span class="fu">map</span> (noBindS <span class="op">.</span> appE [<span class="op">|</span> \xs <span class="ot">-&gt;</span> <span class="fu">and</span> <span class="op">$</span> <span class="fu">zipWith</span> (<span class="op">==</span>) xs (<span class="fu">tail</span> xs) <span class="op">|</span>] <span class="op">.</span> listE <span class="op">.</span> <span class="fu">map</span> (varE <span class="op">.</span> mkName <span class="op">.</span> normalizeName) <span class="op">.</span> <span class="fu">snd</span>) <span class="op">$</span> <span class="fu">filter</span> (<span class="fu">not</span><span class="op">.</span> <span class="fu">null</span> <span class="op">.</span> <span class="fu">drop</span> <span class="dv">1</span> <span class="op">.</span> <span class="fu">snd</span>) <span class="op">$</span> M.toList dic</span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>      sig <span class="ot">&lt;-</span> sigD (mkName name) <span class="op">$</span> <span class="fu">foldr</span> arrow [t| [Sequent] -&gt; Maybe Sequent |] <span class="op">$</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>         <span class="fu">map</span> (<span class="fu">const</span> [t| Formula |]) unknown</span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>      fun <span class="ot">&lt;-</span> funD (mkName name) [ clause (<span class="fu">map</span> (varP <span class="op">.</span> mkName) unknown<span class="op">++</span>[<span class="fu">return</span> <span class="kw">pattern</span>])</span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a>                                  (guardedB [liftM2 (,) guards <span class="op">$</span> appE [<span class="op">|</span><span class="dt">Just</span><span class="op">|</span>] (<span class="fu">return</span> body)])</span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a>                                  []</span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a>                         , clause (wildP<span class="op">:</span><span class="fu">map</span> (<span class="fu">const</span> wildP) unknown) (normalB [<span class="op">|</span><span class="dt">Nothing</span><span class="op">|</span>]) []</span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>                         ]</span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span> [sig, fun]</span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a><span class="ot">    expq ::</span> [<span class="dt">Formula</span>] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">ExpQ</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>    expq gs <span class="ot">=</span> <span class="dt">Just</span> [<span class="op">|</span> <span class="fu">concat</span> <span class="op">$</span>(listE <span class="op">$</span> <span class="fu">map</span> (appE [<span class="op">|</span> toFormulaList <span class="op">|</span>] <span class="op">.</span> dataToExpQ (mkQ <span class="dt">Nothing</span> <span class="op">$</span> trans varE)) gs) <span class="op">|</span>]</span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a><span class="ot">    pat ::</span> [<span class="dt">Formula</span>] <span class="ot">-&gt;</span> <span class="dt">Maybe</span> <span class="dt">PatQ</span></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a>    pat fs <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> <span class="fu">foldr1</span> (\a b <span class="ot">-&gt;</span> infixP a (&#39;(<span class="op">:</span>)) b) <span class="op">$</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a>               <span class="fu">map</span> (dataToPatQ (mkQ <span class="dt">Nothing</span> <span class="op">$</span> trans varP)) fs</span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>    trans var (<span class="dt">Var</span> str) <span class="ot">=</span> <span class="dt">Just</span> <span class="op">$</span> var <span class="op">$</span> mkName <span class="op">$</span> normalizeName str</span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>    trans _ _ <span class="ot">=</span> <span class="dt">Nothing</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>    normalizeName [c]</span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>        <span class="op">|</span> <span class="dt">Just</span> prfx <span class="ot">&lt;-</span> <span class="fu">lookup</span> c greeks <span class="ot">=</span> prfx <span class="op">:</span> <span class="st">&quot;s&quot;</span></span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>    normalizeName xs <span class="ot">=</span> <span class="fu">map</span> <span class="fu">toLower</span> xs</span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>    extractName (<span class="dt">Var</span> v) <span class="ot">=</span> [normalizeName v]</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a>    extractName _       <span class="ot">=</span> []</span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a>    renamer (<span class="dt">Var</span> name) <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a>      dic <span class="ot">&lt;-</span> get</span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a>      <span class="kw">case</span> M.lookup name dic <span class="kw">of</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Nothing</span> <span class="ot">-&gt;</span> <span class="kw">do</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>          put <span class="op">$</span> M.insert name [name] dic</span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span> <span class="op">$</span> <span class="dt">Var</span> name</span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>        <span class="dt">Just</span> xs <span class="ot">-&gt;</span> <span class="kw">do</span></span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>          name&#39; <span class="ot">&lt;-</span> <span class="fu">show</span> <span class="op">&lt;$&gt;</span> lift (newName name)</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>          put <span class="op">$</span> M.insert name (name&#39; <span class="op">:</span> xs) dic</span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span> <span class="op">$</span> <span class="dt">Var</span> name&#39;</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell:lkdatatypes.hs"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ot">{-# LANGUAGE DeriveDataTypeable, RecordWildCards, FlexibleInstances #-}</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">module</span> <span class="dt">LKDataTypes</span> <span class="kw">where</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Parsec.Expr</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Parsec</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Text.Parsec.Token</span> <span class="kw">as</span> <span class="dt">T</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Text.Parsec.String</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.List</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Control.Applicative</span> <span class="kw">hiding</span> (many, (&lt;|&gt;))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.List</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Either</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="dt">Data.Data</span> (<span class="dt">Typeable</span>, <span class="dt">Data</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>infix  <span class="dv">6</span> <span class="op">:|-</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="kw">infixr</span> <span class="dv">7</span> <span class="op">:-&gt;:</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">8</span> <span class="op">:</span>\<span class="op">/:</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="kw">infixl</span> <span class="dv">9</span> <span class="op">:/</span>\<span class="op">:</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Formula</span> <span class="ot">=</span> <span class="dt">Var</span> <span class="dt">String</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>             <span class="op">|</span> <span class="dt">Not</span> <span class="dt">Formula</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>             <span class="op">|</span> <span class="dt">Formula</span> <span class="op">:</span>\<span class="op">/:</span> <span class="dt">Formula</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>             <span class="op">|</span> <span class="dt">Formula</span> <span class="op">:-&gt;:</span> <span class="dt">Formula</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>             <span class="op">|</span> <span class="dt">Formula</span> <span class="op">:/</span>\<span class="op">:</span> <span class="dt">Formula</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>               <span class="kw">deriving</span> (<span class="dt">Read</span>, <span class="dt">Eq</span>, <span class="dt">Ord</span>, <span class="dt">Data</span>, <span class="dt">Typeable</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="kw">data</span> <span class="dt">Sequent</span> <span class="ot">=</span> (<span class="op">:|-</span>) {<span class="ot"> lefts ::</span> [<span class="dt">Formula</span>],<span class="ot"> rights ::</span> [<span class="dt">Formula</span>] }</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>             <span class="kw">deriving</span> (<span class="dt">Eq</span>, <span class="dt">Ord</span>, <span class="dt">Data</span>, <span class="dt">Typeable</span>)</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Show</span> <span class="dt">Formula</span> <span class="kw">where</span></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showsPrec</span> _ (<span class="dt">Var</span> v)    <span class="ot">=</span> <span class="fu">showString</span> v</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showsPrec</span> d (<span class="dt">Not</span> f)    <span class="ot">=</span> <span class="fu">showString</span> <span class="st">&quot;¬&quot;</span> <span class="op">.</span> <span class="fu">showsPrec</span> <span class="dv">11</span> f</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showsPrec</span> d (l <span class="op">:</span>\<span class="op">/:</span> r) <span class="ot">=</span> <span class="fu">showParen</span> (d <span class="op">&gt;</span> <span class="dv">7</span>) <span class="op">$</span> <span class="fu">showsPrec</span> <span class="dv">8</span> l <span class="op">.</span> <span class="fu">showString</span> <span class="st">&quot; ∨ &quot;</span> <span class="op">.</span> <span class="fu">showsPrec</span> <span class="dv">8</span> r</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showsPrec</span> d (l <span class="op">:-&gt;:</span> r) <span class="ot">=</span> <span class="fu">showParen</span> (d <span class="op">&gt;</span> <span class="dv">6</span>) <span class="op">$</span> <span class="fu">showsPrec</span> <span class="dv">7</span> l <span class="op">.</span> <span class="fu">showString</span> <span class="st">&quot; → &quot;</span> <span class="op">.</span> <span class="fu">showsPrec</span> <span class="dv">7</span> r</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showsPrec</span> d (l <span class="op">:/</span>\<span class="op">:</span> r) <span class="ot">=</span> <span class="fu">showParen</span> (d <span class="op">&gt;</span> <span class="dv">8</span>) <span class="op">$</span> <span class="fu">showsPrec</span> <span class="dv">9</span> l <span class="op">.</span> <span class="fu">showString</span> <span class="st">&quot; ∧ &quot;</span> <span class="op">.</span> <span class="fu">showsPrec</span> <span class="dv">9</span> r</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">Show</span> <span class="dt">Sequent</span> <span class="kw">where</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">showsPrec</span> d (l <span class="op">:|-</span> r) <span class="ot">=</span> <span class="fu">showParen</span> (d <span class="op">&gt;</span> <span class="dv">10</span>) <span class="op">$</span> showsFs l <span class="op">.</span> <span class="fu">showString</span> <span class="st">&quot; |- &quot;</span> <span class="op">.</span> showsFs (<span class="fu">reverse</span> r)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">where</span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>      showsFs fs <span class="ot">=</span> <span class="fu">foldr</span> (<span class="op">.</span>) <span class="fu">id</span> <span class="op">$</span> intersperse (<span class="fu">showString</span> <span class="st">&quot;, &quot;</span>) <span class="op">$</span> <span class="fu">map</span> <span class="fu">shows</span> fs</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>greek <span class="ot">=</span> oneOf <span class="st">&quot;ΓΔΣΠΘΛΞΦΨΩ&quot;</span></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a><span class="ot">lang ::</span> <span class="dt">T.LanguageDef</span> ()</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>lang <span class="ot">=</span> <span class="dt">T.LanguageDef</span> { T.commentStart <span class="ot">=</span> <span class="st">&quot;{-&quot;</span></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>                     , T.commentEnd   <span class="ot">=</span> <span class="st">&quot;-}&quot;</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>                     , T.commentLine  <span class="ot">=</span> <span class="st">&quot;#&quot;</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>                     , T.nestedComments <span class="ot">=</span> <span class="dt">True</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>                     , T.identStart     <span class="ot">=</span> letter <span class="op">&lt;|&gt;</span> greek</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>                     , T.identLetter    <span class="ot">=</span> alphaNum <span class="op">&lt;|&gt;</span> greek <span class="op">&lt;|&gt;</span> char <span class="ch">&#39;\&#39;&#39;</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>                     , T.opStart        <span class="ot">=</span> empty</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>                     , T.opLetter       <span class="ot">=</span> empty</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>                     , T.reservedNames  <span class="ot">=</span> []</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>                     , T.reservedOpNames <span class="ot">=</span> [<span class="st">&quot;~&quot;</span>, <span class="st">&quot;-&gt;&quot;</span>, <span class="st">&quot;\\/&quot;</span>, <span class="st">&quot;/\\&quot;</span>, <span class="st">&quot;⊃&quot;</span>, <span class="st">&quot;|-&quot;</span></span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                                           ,<span class="st">&quot;¬&quot;</span>, <span class="st">&quot;→&quot;</span>, <span class="st">&quot;∧&quot;</span>, <span class="st">&quot;∨&quot;</span>, <span class="st">&quot;^&quot;</span>, <span class="st">&quot;v&quot;</span>, <span class="st">&quot;├&quot;</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>                                           ]</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>                     , T.caseSensitive   <span class="ot">=</span> <span class="dt">True</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>                     }</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="dt">T.TokenParser</span> {<span class="op">..</span>} <span class="ot">=</span> T.makeTokenParser lang</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="ot">formula ::</span> <span class="dt">Parser</span> <span class="dt">Formula</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">=</span> buildExpressionParser table term</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>      <span class="op">&lt;?&gt;</span> <span class="st">&quot;formula&quot;</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>term <span class="ot">=</span> parens formula</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>   <span class="op">&lt;|&gt;</span> <span class="dt">Var</span> <span class="op">&lt;$&gt;</span> identifier</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>table <span class="ot">=</span> [ [ <span class="dt">Prefix</span> <span class="op">$</span> <span class="dt">Not</span>   <span class="op">&lt;$</span> choice (<span class="fu">map</span> reservedOp [<span class="st">&quot;~&quot;</span>, <span class="st">&quot;¬&quot;</span>])]</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>        , [ <span class="dt">Infix</span>  ((<span class="op">:/</span>\<span class="op">:</span>) <span class="op">&lt;$</span> choice (<span class="fu">map</span> reservedOp [<span class="st">&quot;∧&quot;</span>, <span class="st">&quot;/\\&quot;</span>, <span class="st">&quot;^&quot;</span>])) <span class="dt">AssocLeft</span> ]</span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>        , [ <span class="dt">Infix</span>  ((<span class="op">:</span>\<span class="op">/:</span>) <span class="op">&lt;$</span> choice (<span class="fu">map</span> reservedOp [<span class="st">&quot;∨&quot;</span>, <span class="st">&quot;\\/&quot;</span>, <span class="st">&quot;v&quot;</span>])) <span class="dt">AssocLeft</span> ]</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>        , [ <span class="dt">Infix</span>  ((<span class="op">:-&gt;:</span>) <span class="op">&lt;$</span> choice (<span class="fu">map</span> reservedOp [<span class="st">&quot;→&quot;</span>, <span class="st">&quot;-&gt;&quot;</span>, <span class="st">&quot;⊃&quot;</span>])) <span class="dt">AssocRight</span> ]</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>sequent <span class="ot">=</span> (<span class="op">:|-</span>) <span class="op">&lt;$&gt;</span> fs <span class="op">&lt;*</span> (choice <span class="op">$</span> <span class="fu">map</span> reservedOp [<span class="st">&quot;|-&quot;</span>, <span class="st">&quot;├&quot;</span>])</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>                <span class="op">&lt;*&gt;</span> (<span class="fu">reverse</span> <span class="op">&lt;$&gt;</span> fs)</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>  <span class="kw">where</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>    fs <span class="ot">=</span> formula <span class="ot">`sepBy`</span> comma</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>parseSequent <span class="ot">=</span> run sequent</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>parseFormula <span class="ot">=</span> run formula</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>run p src <span class="ot">=</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> parse (whiteSpace <span class="op">*&gt;</span> p <span class="op">&lt;*</span> eof) <span class="st">&quot;&quot;</span> src <span class="kw">of</span></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Left</span> err <span class="ot">-&gt;</span> <span class="fu">error</span> <span class="op">$</span> <span class="fu">show</span> err</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>      <span class="dt">Right</span> ans <span class="ot">-&gt;</span> ans</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> <span class="dt">FormulaListable</span> a <span class="kw">where</span></span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a><span class="ot">  toFormulaList ::</span> a <span class="ot">-&gt;</span> [<span class="dt">Formula</span>]</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">FormulaListable</span> <span class="dt">Formula</span> <span class="kw">where</span></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>  toFormulaList <span class="ot">=</span> <span class="fu">pure</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a><span class="kw">instance</span> <span class="dt">FormulaListable</span> [<span class="dt">Formula</span>] <span class="kw">where</span></span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>  toFormulaList <span class="ot">=</span> <span class="fu">id</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>deducRule <span class="ot">=</span> (,,) <span class="op">&lt;$&gt;</span> (sequent <span class="ot">`sepBy`</span> whiteSpace)</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>                 <span class="op">&lt;*</span>  lexeme (skipMany1 (char <span class="ch">&#39;-&#39;</span>))</span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>                 <span class="op">&lt;*&gt;</span> identifier</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>                 <span class="op">&lt;*&gt;</span> sequent</span></code></pre></div>
          <hr>
          <!-- DISQUS -->
          <section id="disqus_area" class="mx-1 mx-md-3 mx-lg-5">
            <h2>Comments</h2>
          <div id="disqus_thread"></div>
          <script>
          var disqus_config = function () {
          this.page.url = "https://konn-san.com/prog/haskell/lk-proof-assistant-in-haskell.html";
          this.page.identifier = "/prog/haskell/lk-proof-assistant-in-haskell.html";
          };
          (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://konn-san.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          </section>
          <!-- /DISQUS -->
        </div>
      </div>
  <footer>
      <p>
        <a href="//validator.w3.org/check?uri=https%3A%2F%2Fkonn-san.com/prog/haskell/lk-proof-assistant-in-haskell.html">
          <img src="/img/HTML5_Logo_32.png" height="32" alt="HTML5">
	</a>
	<br>
	Powered by <a href="https://shakebuild.com">Shake</a>,
        <a href="https://github.com/konn/sake">Sake</a>,
	<a href="http://johnmacfarlane.net/pandoc/">Pandoc</a>,
	<a href="https://khan.github.io/KaTeX/">KaTeX</a>,
	<a href="https://www.mathjax.org">MathJax</a>,
        and <a href="https://docs.github.com/ja/pages/getting-started-with-github-pages/about-github-pages">GitHub Pages</a>.
	<br>
	Copyright © Hiromi ISHII 2012-2018
      </p>
    </footer>
  <script src="//code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script>
      var _gaq=[['_setAccount','UA-29894567-2'],['_trackPageview']];
      (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
      g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
      s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>


</body></html>
